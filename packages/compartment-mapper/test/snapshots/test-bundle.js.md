# Snapshot report for `test/test-bundle.js`

The actual snapshot is saved in `test-bundle.js.snap`.

Generated by [AVA](https://avajs.dev).

## bundles work

> Snapshot 1

    `'use strict';␊
    (() => {␊
      const functors = [␊
    // === functors[0] ===␊
    (function (require, exports, module, __filename, __dirname) { const hello = 1;␊
    module.exports = { hello } //*/␊
    })␊
    //# sourceURL=file:///home/xyz/Development/endo/packages/compartment-mapper/test/fixtures-0/node_modules/bundle/requireme.cjs␊
    ,␊
    // === functors[1] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([]);   const{default:$c‍_default}={default:'foo'};$h‍_once.default($c‍_default);␊
    })␊
    ,␊
    // === functors[2] ===␊
    (function (require, exports, module, __filename, __dirname) { const zzz = require('./requireme.cjs').hello || 404;␊
    const fromMjs = require('./import-default-export-from-me');␊
    module.exports = { zzz, fromMjs }; //*/␊
    })␊
    //# sourceURL=file:///home/xyz/Development/endo/packages/compartment-mapper/test/fixtures-0/node_modules/bundle/icando.cjs␊
    ,␊
    // === functors[3] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([]);   const        c=  'sea';$h‍_once.c(c);␊
    const        i=  'eye';$h‍_once.i(i);␊
    const        k=  'que';$h‍_once.k(k);␊
    const        q=  'cue';$h‍_once.q(q);␊
    const        u=  'you';$h‍_once.u(u);␊
    const        y=  'why';$h‍_once.y(y);␊
    })␊
    ,␊
    // === functors[4] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([]);   const        color=  'blue';$h‍_once.color(color);␊
    })␊
    ,␊
    // === functors[5] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([]);   const fizz=  'fizz';$h‍_once.fizz(fizz);␊
    const bizz=  'bizz';$h‍_once.bizz(bizz);␊
    const buzz=  'buzz';$h‍_once.buzz(buzz);␊
    })␊
    ,␊
    // === functors[6] ===␊
    {␊
      "name": "bundle",␊
      "parsers": {␊
        "js": "mjs"␊
      },␊
      "main": "./main.js",␊
      "dependencies": {␊
        "bundle-dep": "*"␊
      },␊
      "scripts": {␊
        "preinstall": "echo DO NOT INSTALL TEST FIXTURES; exit -1"␊
      }␊
    }␊
    ,␊
    // === functors[7] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([]);   const        red=  '#f00';$h‍_once.red(red);␊
    const        green=  '#0f0';$h‍_once.green(green);␊
    const        blue=  '#00f';$h‍_once.blue(blue);␊
    })␊
    ,␊
    // === functors[8] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([["./import-and-export-all.js", []]]);   ␊
    })␊
    ,␊
    // === functors[9] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([]);   const        gray=  '#777';$h‍_once.gray(gray);␊
    })␊
    ,␊
    // === functors[10] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([]);   const        qux=  'qux';$h‍_once.qux(qux);␊
    })␊
    ,␊
    // === functors[11] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([["./import-and-reexport-name-from-me.js", []],["./import-and-reexport-name-as-from-me.js", []]]);   ␊
    })␊
    ,␊
    // === functors[12] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   $h‍_imports([]);   print('dependency');␊
    })␊
    ,␊
    // === functors[13] ===␊
    (({   imports: $h‍_imports,   liveVar: $h‍_live,   onceVar: $h‍_once,   importMeta: $h‍____meta,  }) => {   let foo,bar,baz,fizz,buzz,colour,qux,grey,colors,cjsstuff,pkg;$h‍_imports([["./import-default-export-from-me.js", [["default", [$h‍_a => (foo = $h‍_a)]]]],["./import-all-from-me.js", [["*", [$h‍_a => (bar = $h‍_a),$h‍_a => (baz = $h‍_a)]]]],["./import-named-exports-from-me.js", [["fizz", [$h‍_a => (fizz = $h‍_a)]],["buzz", [$h‍_a => (buzz = $h‍_a)]]]],["./import-named-export-and-rename.js", [["color", [$h‍_a => (colour = $h‍_a)]]]],["./reexport-name.js", [["qux", [$h‍_a => (qux = $h‍_a)]],["grey", [$h‍_a => (grey = $h‍_a)]]]],["./reexport-all.js", [["*", [$h‍_a => (colors = $h‍_a)]]]],["bundle-dep", []],["./icando.cjs", [["*", [$h‍_a => (cjsstuff = $h‍_a)]]]],["./package.json", [["default", [$h‍_a => (pkg = $h‍_a)]]]]]);   ␊
    ␊
    ␊
    print(foo);␊
    ␊
    ␊
    print(bar);␊
    // Once more with feeling.␊
    ␊
    print(baz);␊
    ␊
    ␊
    print(fizz);␊
    print(buzz);␊
    ␊
    ␊
    print(colour);␊
    ␊
    ␊
    print(qux);␊
    print(grey);␊
    ␊
    ␊
    print(colors);␊
    ␊
    ␊
    ␊
    ␊
    print(cjsstuff);␊
    ␊
    ␊
    print(pkg.name);␊
    })␊
    ,␊
    ]; // functors end␊
    ␊
      const cell = (name, value = undefined) => {␊
        const observers = [];␊
        return Object.freeze({␊
          get: Object.freeze(() => {␊
            return value;␊
          }),␊
          set: Object.freeze((newValue) => {␊
            value = newValue;␊
            for (const observe of observers) {␊
              observe(value);␊
            }␊
          }),␊
          observe: Object.freeze((observe) => {␊
            observers.push(observe);␊
            observe(value);␊
          }),␊
          enumerable: true,␊
        });␊
      };␊
    ␊
      const cells = [␊
        {␊
          hello: cell("hello"),␊
          default: cell("default"),␊
        },␊
        {␊
          default: cell("default"),␊
        },␊
        {␊
          zzz: cell("zzz"),␊
          fromMjs: cell("fromMjs"),␊
          default: cell("default"),␊
        },␊
        {␊
          c: cell("c"),␊
          i: cell("i"),␊
          k: cell("k"),␊
          q: cell("q"),␊
          u: cell("u"),␊
          y: cell("y"),␊
        },␊
        {␊
          color: cell("color"),␊
        },␊
        {␊
          fizz: cell("fizz"),␊
          bizz: cell("bizz"),␊
          buzz: cell("buzz"),␊
        },␊
        { default: cell('default') }, ␊
        {␊
          red: cell("red"),␊
          green: cell("green"),␊
          blue: cell("blue"),␊
        },␊
        {␊
        },␊
        {␊
          gray: cell("gray"),␊
        },␊
        {␊
          qux: cell("qux"),␊
        },␊
        {␊
          qux: cell("qux"),␊
          grey: cell("grey"),␊
        },␊
        {␊
        },␊
        {␊
        },␊
      ];␊
    ␊
      Object.defineProperties(cells[8], Object.getOwnPropertyDescriptors(cells[7]));␊
    ␊
      Object.defineProperties(cells[11], {"qux": { value: cells[10]["qux"] },"grey": { value: cells[9]["gray"] } });␊
    ␊
      const namespaces = cells.map(cells => Object.freeze(Object.create(null, cells)));␊
    ␊
      for (let index = 0; index < namespaces.length; index += 1) {␊
        cells[index]['*'] = cell('*', namespaces[index]);␊
      }␊
    ␊
    function wrapCjsFunctor(num) {␊
      /* eslint-disable no-undef */␊
      return ({ imports = {} }) => {␊
        const cModule = Object.freeze(␊
          Object.defineProperty({}, 'exports', cells[num].default),␊
        );␊
        // TODO: specifier not found handling␊
        const requireImpl = specifier => cells[imports[specifier]].default.get();␊
        functors[num](Object.freeze(requireImpl), cModule.exports, cModule);␊
        Object.keys(cells[num])␊
          .filter(k => k !== 'default' && k !== '*')␊
          .map(k => cells[num][k].set(cModule.exports[k]));␊
      };␊
      /* eslint-enable no-undef */␊
    }function observeImports(map, importName, importIndex) {␊
      for (const [name, observers] of map.get(importName)) {␊
        const cell = cells[importIndex][name];␊
        if (cell === undefined) {␊
          throw new ReferenceError(\`Cannot import name ${name}\`);␊
        }␊
        for (const observer of observers) {␊
          cell.observe(observer);␊
        }␊
      }␊
    }␊
    ␊
    ␊
      wrapCjsFunctor(0)({imports: {}});␊
      functors[1]({␊
        imports(entries) {␊
          const map = new Map(entries);␊
        },␊
        liveVar: {␊
        },␊
        onceVar: {␊
          default: cells[1].default.set,␊
        },␊
        importMeta: {},␊
      });␊
      wrapCjsFunctor(2)({imports: {"./requireme.cjs":0,"./import-default-export-from-me":1}});␊
      functors[3]({␊
        imports(entries) {␊
          const map = new Map(entries);␊
        },␊
        liveVar: {␊
        },␊
        onceVar: {␊
          c: cells[3].c.set,␊
          i: cells[3].i.set,␊
          k: cells[3].k.set,␊
          q: cells[3].q.set,␊
          u: cells[3].u.set,␊
          y: cells[3].y.set,␊
        },␊
        importMeta: {},␊
      });␊
      functors[4]({␊
        imports(entries) {␊
          const map = new Map(entries);␊
        },␊
        liveVar: {␊
        },␊
        onceVar: {␊
          color: cells[4].color.set,␊
        },␊
        importMeta: {},␊
      });␊
      functors[5]({␊
        imports(entries) {␊
          const map = new Map(entries);␊
        },␊
        liveVar: {␊
        },␊
        onceVar: {␊
          fizz: cells[5].fizz.set,␊
          bizz: cells[5].bizz.set,␊
          buzz: cells[5].buzz.set,␊
        },␊
        importMeta: {},␊
      });␊
      cells[6].default.set(functors[6]);␊
      functors[7]({␊
        imports(entries) {␊
          const map = new Map(entries);␊
        },␊
        liveVar: {␊
        },␊
        onceVar: {␊
          red: cells[7].red.set,␊
          green: cells[7].green.set,␊
          blue: cells[7].blue.set,␊
        },␊
        importMeta: {},␊
      });␊
      functors[8]({␊
        imports(entries) {␊
          const map = new Map(entries);␊
          observeImports(map, "./import-and-export-all.js", 7);␊
        },␊
        liveVar: {␊
        },␊
        onceVar: {␊
        },␊
        importMeta: {},␊
      });␊
      functors[9]({␊
        imports(entries) {␊
          const map = new Map(entries);␊
        },␊
        liveVar: {␊
        },␊
        onceVar: {␊
          gray: cells[9].gray.set,␊
        },␊
        importMeta: {},␊
      });␊
      functors[10]({␊
        imports(entries) {␊
          const map = new Map(entries);␊
        },␊
        liveVar: {␊
        },␊
        onceVar: {␊
          qux: cells[10].qux.set,␊
        },␊
        importMeta: {},␊
      });␊
      functors[11]({␊
        imports(entries) {␊
          const map = new Map(entries);␊
          observeImports(map, "./import-and-reexport-name-as-from-me.js", 9);␊
          observeImports(map, "./import-and-reexport-name-from-me.js", 10);␊
        },␊
        liveVar: {␊
        },␊
        onceVar: {␊
        },␊
        importMeta: {},␊
      });␊
      functors[12]({␊
        imports(entries) {␊
          const map = new Map(entries);␊
        },␊
        liveVar: {␊
        },␊
        onceVar: {␊
        },␊
        importMeta: {},␊
      });␊
      functors[13]({␊
        imports(entries) {␊
          const map = new Map(entries);␊
          observeImports(map, "./icando.cjs", 2);␊
          observeImports(map, "./import-all-from-me.js", 3);␊
          observeImports(map, "./import-default-export-from-me.js", 1);␊
          observeImports(map, "./import-named-export-and-rename.js", 4);␊
          observeImports(map, "./import-named-exports-from-me.js", 5);␊
          observeImports(map, "./package.json", 6);␊
          observeImports(map, "./reexport-all.js", 8);␊
          observeImports(map, "./reexport-name.js", 11);␊
          observeImports(map, "bundle-dep", 12);␊
        },␊
        liveVar: {␊
        },␊
        onceVar: {␊
        },␊
        importMeta: {},␊
      });␊
    ␊
      return cells[cells.length - 1]['*'].get();␊
    })();␊
    `

> Snapshot 2

    {
      bundleSize: 10072,
    }
